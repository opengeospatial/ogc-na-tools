
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../gsp/">
      
      
        <link rel="next" href="../input_filters/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>ingest_json - OGC Naming Authority tools</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ogc.na.ingest_json" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="OGC Naming Authority tools" class="md-header__button md-logo" aria-label="OGC Naming Authority tools" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OGC Naming Authority tools
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ingest_json
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="OGC Naming Authority tools" class="md-nav__button md-logo" aria-label="OGC Naming Authority tools" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OGC Naming Authority tools
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../jsonld-uplift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON-LD Uplift
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ogc.na
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            ogc.na
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../_version/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    _version
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotate_schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    annotate_schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../domain_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    domain_config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../download/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    download
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gsp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gsp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ingest_json
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ingest_json
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json" class="md-nav__link">
    <span class="md-ellipsis">
      ingest_json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.filenames_from_context" class="md-nav__link">
    <span class="md-ellipsis">
      filenames_from_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.find_contexts" class="md-nav__link">
    <span class="md-ellipsis">
      find_contexts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.generate_graph" class="md-nav__link">
    <span class="md-ellipsis">
      generate_graph
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.process" class="md-nav__link">
    <span class="md-ellipsis">
      process
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.process_file" class="md-nav__link">
    <span class="md-ellipsis">
      process_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.uplift_json" class="md-nav__link">
    <span class="md-ellipsis">
      uplift_json
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../input_filters/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    input_filters
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_7" id="__nav_5_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_7">
            <span class="md-nav__icon md-icon"></span>
            input_filters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../input_filters/csv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    csv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../input_filters/xml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xml
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../provenance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    provenance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update_vocabs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    update_vocabs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    util
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    validation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json" class="md-nav__link">
    <span class="md-ellipsis">
      ingest_json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.filenames_from_context" class="md-nav__link">
    <span class="md-ellipsis">
      filenames_from_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.find_contexts" class="md-nav__link">
    <span class="md-ellipsis">
      find_contexts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.generate_graph" class="md-nav__link">
    <span class="md-ellipsis">
      generate_graph
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.process" class="md-nav__link">
    <span class="md-ellipsis">
      process
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.process_file" class="md-nav__link">
    <span class="md-ellipsis">
      process_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ogc.na.ingest_json.uplift_json" class="md-nav__link">
    <span class="md-ellipsis">
      uplift_json
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>ingest_json</h1>

<div class="doc doc-object doc-module">



<a id="ogc.na.ingest_json"></a>
  <div class="doc doc-contents first">
  
      <p>This module contains classes to perform JSON-LD uplifting operations, facilitating
the conversion of standard JSON into JSON-LD.</p>
<p>JSON-LD uplifting is done in 4 steps:</p>
<ul>
<li>Input filter pre-processing (e.g., csv). This step is <em>optional</em>.</li>
<li>Initial transformation using <a href="https://stedolan.github.io/jq/manual/">jq</a> expressions (<code>transform</code>).</li>
<li>Class annotation (adding <code>@type</code> to the root object and/or to specific nodes, using
  <a href="https://pypi.org/project/jsonpath-ng/">jsonpath-ng</a> expressions) (<code>types</code>).</li>
<li>Injecting custom JSON-LD <code>@context</code> either globally or inside specific nodes (using
  <a href="https://pypi.org/project/jsonpath-ng/">jsonpath-ng</a> expressions (<code>context</code>).</li>
</ul>
<p>The details for each of these operations are declared inside context definition files,
which are YAML documents containing specifications for the uplift workflow. For each input
JSON file, its corresponding YAML context definition is detected at runtime:</p>
<ol>
<li>A <a class="autorefs autorefs-internal" href="../domain_config/#ogc.na.domain_config.DomainConfiguration">domain configuration</a> can be used,
which is a JSON (or YAML) document that defines JSON file to context definition mappings.</li>
<li>If no registry is used or the input file is not in the registry, a file with the same
name but <code>.yml</code> extension will be used, if it exists.</li>
<li>Otherwise, a <code>_json-context.yml</code> file in the same directory will be used, if it exists.</li>
</ol>
<p>If no context definition file is found after performing the previous 3 steps, then the file will
be skipped.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="ogc.na.ingest_json.filenames_from_context" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">filenames_from_context</span><span class="p">(</span><span class="n">context_fn</span><span class="p">,</span> <span class="n">domain_config</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Tries to find a JSON/JSON-LD file from a given YAML context definition filename.
Priority:
  1. Context file with same name as JSON doc (e.g. test.yml/test.json)
  2. Context file in domain configuration (if one provided)
  3. Context file in directory (_json-context.yml or _json-context.yaml)</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>context_fn</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span> | str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>YAML context definition filename</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>domain_config</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="ogc.na.domain_config.DomainConfiguration" href="../domain_config/#ogc.na.domain_config.DomainConfiguration">DomainConfiguration</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dict of jsonFile:yamlContextFile mappings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[<span title="pathlib.Path">Path</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>corresponding JSON/JSON-LD filename, if found</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>ogc/na/ingest_json.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filenames_from_context</span><span class="p">(</span><span class="n">context_fn</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">domain_config</span><span class="p">:</span> <span class="n">DomainConfiguration</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tries to find a JSON/JSON-LD file from a given YAML context definition filename.</span>
<span class="sd">    Priority:</span>
<span class="sd">      1. Context file with same name as JSON doc (e.g. test.yml/test.json)</span>
<span class="sd">      2. Context file in domain configuration (if one provided)</span>
<span class="sd">      3. Context file in directory (_json-context.yml or _json-context.yaml)</span>
<span class="sd">    :param context_fn: YAML context definition filename</span>
<span class="sd">    :param domain_config: dict of jsonFile:yamlContextFile mappings</span>
<span class="sd">    :return: corresponding JSON/JSON-LD filename, if found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context_fn</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">context_fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">context_fn</span><span class="p">)</span>

    <span class="c1"># 1. Lookup by matching filename</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*\.json-?(ld)?$&#39;</span><span class="p">,</span> <span class="n">context_fn</span><span class="o">.</span><span class="n">stem</span><span class="p">):</span>
        <span class="c1"># If removing extension results in a JSON/JSON-LD</span>
        <span class="c1"># filename, try it</span>
        <span class="n">json_fn</span> <span class="o">=</span> <span class="n">context_fn</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">json_fn</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">json_fn</span><span class="p">)</span>
    <span class="c1"># Otherwise check with appended JSON/JSON-LD extensions</span>
    <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;.jsonld&#39;</span><span class="p">,</span> <span class="s1">&#39;.json-ld&#39;</span><span class="p">):</span>
        <span class="n">json_fn</span> <span class="o">=</span> <span class="n">context_fn</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">json_fn</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">json_fn</span><span class="p">)</span>

    <span class="c1"># 2. Reverse lookup in registry</span>
    <span class="k">if</span> <span class="n">domain_config</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">domain_config</span><span class="o">.</span><span class="n">uplift_entries</span><span class="o">.</span><span class="n">find_files_by_context_fn</span><span class="p">(</span><span class="n">context_fn</span><span class="p">))</span>

    <span class="c1"># 3. If directory context file, all .json files in directory</span>
    <span class="c1"># NOTE: no .jsonld or .json-ld files, since those could come</span>
    <span class="c1">#   from the output of this very script</span>
    <span class="c1"># NOTE: excluding those files present in the registry</span>
    <span class="k">if</span> <span class="n">context_fn</span><span class="o">.</span><span class="n">stem</span> <span class="o">==</span> <span class="s1">&#39;_json-context&#39;</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">scandir</span><span class="p">(</span><span class="n">context_fn</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span> <span class="k">as</span> <span class="n">it</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cast</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="ogc.na.ingest_json.find_contexts" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">find_contexts</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">domain_config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Find the YAML context file for a given filename, with the following precedence:
    1. Search in registry (if provided)
    2. Search file with same base name but with yaml/yml extension.
    3. Find _json-context.yml/yaml file in same directory</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span> | str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the filename for which to find the context</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>domain_config</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="ogc.na.domain_config.DomainConfiguration" href="../domain_config/#ogc.na.domain_config.DomainConfiguration">DomainConfiguration</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>an optional filename:yamlContextFile mapping</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[<span title="pathlib.Path">Path</span> | str] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the YAML context definition paths (Path) and/or profile URIs (str)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>ogc/na/ingest_json.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_contexts</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">domain_config</span><span class="p">:</span> <span class="n">DomainConfiguration</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the YAML context file for a given filename, with the following precedence:</span>
<span class="sd">        1. Search in registry (if provided)</span>
<span class="sd">        2. Search file with same base name but with yaml/yml extension.</span>
<span class="sd">        3. Find _json-context.yml/yaml file in same directory</span>
<span class="sd">    :param filename: the filename for which to find the context</span>
<span class="sd">    :param domain_config: an optional filename:yamlContextFile mapping</span>
<span class="sd">    :return: the YAML context definition paths (Path) and/or profile URIs (str)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># 1. Registry lookup</span>
    <span class="k">if</span> <span class="n">domain_config</span><span class="p">:</span>
        <span class="n">entry</span><span class="p">:</span> <span class="n">UpliftConfigurationEntry</span> <span class="o">=</span> <span class="n">domain_config</span><span class="o">.</span><span class="n">uplift_entries</span><span class="o">.</span><span class="n">find_entry_for_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entry</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">entry</span><span class="o">.</span><span class="n">uplift_definitions</span>

    <span class="c1"># 2. Same filename with yml/yaml extension or autodetect in dir</span>
    <span class="k">for</span> <span class="n">context_path</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.yml&#39;</span><span class="p">),</span>
        <span class="n">filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.yaml&#39;</span><span class="p">),</span>
        <span class="n">filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.yml&#39;</span><span class="p">),</span>
        <span class="n">filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.yaml&#39;</span><span class="p">),</span>
        <span class="n">filename</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;_json-context.yml&#39;</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;_json-context.yaml&#39;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">context_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.jsonld&#39;</span> <span class="ow">and</span> <span class="n">filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Autodetected context </span><span class="si">{</span><span class="n">context_path</span><span class="si">}</span><span class="s1"> for file </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">context_path</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="ogc.na.ingest_json.generate_graph" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_graph</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fetch_url_whitelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Create a graph from an input JSON document and a YAML context definition file.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_data</code></td>
          <td>
                <code>dict | list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>input JSON data in dict or list format</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>dict[str, <span title="typing.Any">Any</span>] | <span title="typing.Sequence">Sequence</span>[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>context definition in dict format, or list thereof</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>base</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>base URI for JSON-LD context</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fetch_url_whitelist</code></td>
          <td>
                <code><span title="typing.Sequence">Sequence</span>[str] | bool | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of regular expressions to filter referenced JSON-LD context URLs before retrieving them. If None, it will not be used; if empty sequence or False, remote fetching operations will throw an exception.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>transform_args</code></td>
          <td>
                <code>dict | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional arguments to pass as variables to the jq transform</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="ogc.na.ingest_json.UpliftResult">UpliftResult</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a tuple with the resulting RDFLib Graph and the JSON-LD enriched file name</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>ogc/na/ingest_json.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_graph</span><span class="p">(</span><span class="n">input_data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span><span class="p">,</span>
                   <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">base</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">fetch_url_whitelist</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">transform_args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UpliftResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a graph from an input JSON document and a YAML context definition file.</span>

<span class="sd">    :param input_data: input JSON data in dict or list format</span>
<span class="sd">    :param context: context definition in dict format, or list thereof</span>
<span class="sd">    :param base: base URI for JSON-LD context</span>
<span class="sd">    :param fetch_url_whitelist: list of regular expressions to filter referenced JSON-LD context URLs before</span>
<span class="sd">        retrieving them. If None, it will not be used; if empty sequence or False, remote fetching operations will</span>
<span class="sd">        throw an exception.</span>
<span class="sd">    :param transform_args: Additional arguments to pass as variables to the jq transform</span>
<span class="sd">    :return: a tuple with the resulting RDFLib Graph and the JSON-LD enriched file name</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input_data must be a list or dictionary&#39;</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
    <span class="n">jdoc_ld</span> <span class="o">=</span> <span class="n">input_data</span>
    <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
        <span class="n">base_uri</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">DEFAULT_NAMESPACES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">g</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">Namespace</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span>

        <span class="n">context_list</span> <span class="o">=</span> <span class="n">context</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">context</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">context_entry</span> <span class="ow">in</span> <span class="n">context_list</span><span class="p">:</span>
            <span class="n">base_uri</span> <span class="o">=</span> <span class="n">context_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;base-uri&#39;</span><span class="p">,</span> <span class="n">base_uri</span><span class="p">)</span>
            <span class="n">jdoc_ld</span> <span class="o">=</span> <span class="n">uplift_json</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">context_entry</span><span class="p">,</span>
                                  <span class="n">transform_args</span><span class="o">=</span><span class="n">transform_args</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;context&#39;</span> <span class="ow">in</span> <span class="n">context_entry</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;$&#39;</span> <span class="ow">in</span> <span class="n">context_entry</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">]:</span>
                    <span class="n">root_ctx</span> <span class="o">=</span> <span class="n">context_entry</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;$&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">context_entry</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">]:</span>
                    <span class="n">root_ctx</span> <span class="o">=</span> <span class="n">context_entry</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;.&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root_ctx</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">term_val</span> <span class="ow">in</span> <span class="n">root_ctx</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">term</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span> \
                                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term_val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> \
                                <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.+[#/:]$&#39;</span><span class="p">,</span> <span class="n">term_val</span><span class="p">)</span> \
                                <span class="ow">and</span> <span class="n">is_iri</span><span class="p">(</span><span class="n">term_val</span><span class="p">):</span>
                            <span class="n">g</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">term_val</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">base_uri</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;base-uri&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s1">&#39;@context&#39;</span> <span class="ow">in</span> <span class="n">jdoc_ld</span><span class="p">:</span>
                <span class="c1"># Try to extract from @context</span>
                <span class="c1"># If it is a list, iterate until @base is found</span>
                <span class="n">base</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jdoc_ld</span><span class="p">[</span><span class="s1">&#39;@context&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">jdoc_ld</span><span class="p">[</span><span class="s1">&#39;@context&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="n">base</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;@base&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">base</span><span class="p">:</span>
                            <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If not a list, just look @base up</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="n">jdoc_ld</span><span class="p">[</span><span class="s1">&#39;@context&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;@base&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Uplifted JSON:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jdoc_ld</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">remote_context_url_filter</span><span class="p">(</span><span class="n">url_whitelist</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">url_whitelist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">url_whitelist</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">url_whitelist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url_whitelist</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">url_whitelist</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">url_whitelist</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url_whitelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">url_whitelist</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">url_whitelist</span><span class="p">)</span>

    <span class="n">g</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jdoc_ld</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json-ld&#39;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
            <span class="n">remote_context_url_filter</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">remote_context_url_filter</span><span class="p">,</span> <span class="n">fetch_url_whitelist</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">UpliftResult</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">uplifted_json</span><span class="o">=</span><span class="n">jdoc_ld</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="ogc.na.ingest_json.process" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">domain_cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">jsonld_fn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ttl_fn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_on_missing_context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">provenance_base_uri</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fetch_url_whitelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Performs the JSON-LD uplift process.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_files</code></td>
          <td>
                <code>str | <span title="pathlib.Path">Path</span> | <span title="typing.Sequence">Sequence</span>[str | <span title="pathlib.Path">Path</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of input, plain JSON files</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>domain_cfg</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="ogc.na.domain_config.DomainConfiguration" href="../domain_config/#ogc.na.domain_config.DomainConfiguration">DomainConfiguration</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>domain configuration including uplift definition locations</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>context_fn</code></td>
          <td>
                <code>str | <span title="pathlib.Path">Path</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>used to force the YAML context file name for the uplift. If <code>None</code>, it will be autodetected</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>jsonld_fn</code></td>
          <td>
                <code>bool | str | <span title="pathlib.Path">Path</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>output file name for the JSON-LD content. If it is <code>False</code>, no JSON-LD output will be generated. If it is <code>None</code>, output will be written to stdout.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>ttl_fn</code></td>
          <td>
                <code>bool | str | <span title="pathlib.Path">Path</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>output file name for the Turtle RDF content. If it is <code>False</code>, no Turtle output will be generated. If it is <code>None</code>, output will be written to stdout.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>batch</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>in batch mode, all JSON input files are obtained from the context registry and processed</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>base</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>base URI to employ</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>skip_on_missing_context</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to silently fail if no context file is found</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>provenance_base_uri</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[str, bool]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>base URI for provenance resources</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fetch_url_whitelist</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>, bool]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of regular expressions to filter referenced JSON-LD context URLs before retrieving them. If None, it will not be used; if empty sequence or False, remote fetching operations will throw an exception</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>transform_args</code></td>
          <td>
                <code>dict | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional arguments to pass as variables to the jq transform</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>file_filter</code></td>
          <td>
                <code>str | <span title="re.Pattern">Pattern</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Filename filter for input files</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[<span title="ogc.na.ingest_json.UpliftResult">UpliftResult</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a list of JSON-LD and/or Turtle output files</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>ogc/na/ingest_json.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">input_files</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">],</span>
            <span class="n">domain_cfg</span><span class="p">:</span> <span class="n">DomainConfiguration</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">context_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">jsonld_fn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ttl_fn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">base</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">skip_on_missing_context</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">provenance_base_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">fetch_url_whitelist</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">transform_args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">file_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">UpliftResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs the JSON-LD uplift process.</span>

<span class="sd">    :param input_files: list of input, plain JSON files</span>
<span class="sd">    :param domain_cfg: domain configuration including uplift definition locations</span>
<span class="sd">    :param context_fn: used to force the YAML context file name for the uplift. If `None`,</span>
<span class="sd">           it will be autodetected</span>
<span class="sd">    :param jsonld_fn: output file name for the JSON-LD content. If it is `False`, no JSON-LD</span>
<span class="sd">           output will be generated. If it is `None`, output will be written to stdout.</span>
<span class="sd">    :param ttl_fn: output file name for the Turtle RDF content. If it is `False`, no Turtle</span>
<span class="sd">           output will be generated. If it is `None`, output will be written to stdout.</span>
<span class="sd">    :param batch: in batch mode, all JSON input files are obtained from the context registry</span>
<span class="sd">           and processed</span>
<span class="sd">    :param base: base URI to employ</span>
<span class="sd">    :param skip_on_missing_context: whether to silently fail if no context file is found</span>
<span class="sd">    :param provenance_base_uri: base URI for provenance resources</span>
<span class="sd">    :param fetch_url_whitelist: list of regular expressions to filter referenced JSON-LD context URLs before</span>
<span class="sd">        retrieving them. If None, it will not be used; if empty sequence or False, remote fetching operations will</span>
<span class="sd">        throw an exception</span>
<span class="sd">    :param transform_args: Additional arguments to pass as variables to the jq transform</span>
<span class="sd">    :param file_filter: Filename filter for input files</span>
<span class="sd">    :return: a list of JSON-LD and/or Turtle output files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">UpliftResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">process_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">workdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_files</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
        <span class="n">input_files</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_files</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Input files: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">input_files</span><span class="p">)</span>
        <span class="n">remaining_fn</span><span class="p">:</span> <span class="n">deque</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">input_file</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">input_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                        <span class="n">remaining_fn</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">workdir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">remaining_fn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">remaining_fn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">remaining_fn</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">remaining_fn</span><span class="o">.</span><span class="n">popleft</span><span class="p">())</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">fn</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">file_filter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">file_filter</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*\.ya?ml$&#39;</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
                <span class="c1"># Context file found, try to find corresponding JSON/JSON-LD file(s)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Potential YAML context file found: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
                <span class="n">remaining_fn</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filenames_from_context</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">domain_config</span><span class="o">=</span><span class="n">domain_cfg</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[])</span>
                <span class="k">continue</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;File </span><span class="si">%s</span><span class="s1"> matches, processing&#39;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process_file</span><span class="p">(</span>
                    <span class="n">fn</span><span class="p">,</span>
                    <span class="n">jsonld_fn</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="n">jsonld_fn</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ttl_fn</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="n">ttl_fn</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">context_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                    <span class="n">provenance_base_uri</span><span class="o">=</span><span class="n">provenance_base_uri</span><span class="p">,</span>
                    <span class="n">provenance_process_id</span><span class="o">=</span><span class="n">process_id</span><span class="p">,</span>
                    <span class="n">fetch_url_whitelist</span><span class="o">=</span><span class="n">fetch_url_whitelist</span><span class="p">,</span>
                    <span class="n">domain_cfg</span><span class="o">=</span><span class="n">domain_cfg</span><span class="p">,</span>
                    <span class="n">transform_args</span><span class="o">=</span><span class="n">transform_args</span><span class="p">,</span>
                <span class="p">))</span>
            <span class="k">except</span> <span class="n">MissingContextException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">skip_on_missing_context</span> <span class="ow">or</span> <span class="n">batch</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error processing JSON/JSON-LD file, skipping: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">input_file</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process_file</span><span class="p">(</span>
                    <span class="n">input_file</span><span class="p">,</span>
                    <span class="n">jsonld_fn</span><span class="o">=</span><span class="n">jsonld_fn</span> <span class="k">if</span> <span class="n">jsonld_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                    <span class="n">ttl_fn</span><span class="o">=</span><span class="n">ttl_fn</span> <span class="k">if</span> <span class="n">ttl_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                    <span class="n">context_fn</span><span class="o">=</span><span class="n">context_fn</span><span class="p">,</span>
                    <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                    <span class="n">provenance_base_uri</span><span class="o">=</span><span class="n">provenance_base_uri</span><span class="p">,</span>
                    <span class="n">provenance_process_id</span><span class="o">=</span><span class="n">process_id</span><span class="p">,</span>
                    <span class="n">fetch_url_whitelist</span><span class="o">=</span><span class="n">fetch_url_whitelist</span><span class="p">,</span>
                    <span class="n">domain_cfg</span><span class="o">=</span><span class="n">domain_cfg</span><span class="p">,</span>
                    <span class="n">transform_args</span><span class="o">=</span><span class="n">transform_args</span><span class="p">,</span>
                <span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">skip_on_missing_context</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error processing JSON/JSON-LD file, skipping: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="ogc.na.ingest_json.process_file" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">process_file</span><span class="p">(</span><span class="n">input_fn</span><span class="p">,</span> <span class="n">jsonld_fn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ttl_fn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain_cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">provenance_base_uri</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">provenance_process_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fetch_url_whitelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Process input file and generate output RDF files.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fn</code></td>
          <td>
                <code>str | <span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>input filename</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>jsonld_fn</code></td>
          <td>
                <code>str | <span title="pathlib.Path">Path</span> | bool | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>output JSON-lD filename (None for automatic). If False, no JSON-LD output will be generated</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>ttl_fn</code></td>
          <td>
                <code>str | <span title="pathlib.Path">Path</span> | bool | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>output Turtle filename (None for automatic). If False, no Turtle output will be generated.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>context_fn</code></td>
          <td>
                <code>str | <span title="pathlib.Path">Path</span> | <span title="typing.Sequence">Sequence</span>[str | <span title="pathlib.Path">Path</span>] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>YAML context filename. If None, will be autodetected: 1. From a file with the same name but yml/yaml extension (test.json -&gt; test.yml) 2. From the domain_cfg 3. From a _json-context.yml/_json-context.yaml file in the same directory</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>domain_cfg</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="ogc.na.domain_config.DomainConfiguration" href="../domain_config/#ogc.na.domain_config.DomainConfiguration">DomainConfiguration</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>domain configuration with uplift definition locations</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>base</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>base URI for JSON-LD</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>provenance_base_uri</code></td>
          <td>
                <code>str | bool | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>base URI for provenance resources</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>provenance_process_id</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>process identifier for provenance tracking</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fetch_url_whitelist</code></td>
          <td>
                <code>bool | <span title="typing.Sequence">Sequence</span>[str] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of regular expressions to filter referenced JSON-LD context URLs before retrieving them. If None, it will not be used; if empty sequence or False, remote fetching operations will throw an exception</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>transform_args</code></td>
          <td>
                <code>dict | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional arguments to pass as variables to the jq transform</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="ogc.na.ingest_json.UpliftResult">UpliftResult</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of output files created</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>ogc/na/ingest_json.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_file</span><span class="p">(</span><span class="n">input_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
                 <span class="n">jsonld_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">ttl_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">context_fn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">domain_cfg</span><span class="p">:</span> <span class="n">DomainConfiguration</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">base</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">provenance_base_uri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">provenance_process_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">fetch_url_whitelist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">transform_args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UpliftResult</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process input file and generate output RDF files.</span>

<span class="sd">    :param input_fn: input filename</span>
<span class="sd">    :param jsonld_fn: output JSON-lD filename (None for automatic).</span>
<span class="sd">        If False, no JSON-LD output will be generated</span>
<span class="sd">    :param ttl_fn: output Turtle filename (None for automatic).</span>
<span class="sd">        If False, no Turtle output will be generated.</span>
<span class="sd">    :param context_fn: YAML context filename. If None, will be autodetected:</span>
<span class="sd">        1. From a file with the same name but yml/yaml extension (test.json -&gt; test.yml)</span>
<span class="sd">        2. From the domain_cfg</span>
<span class="sd">        3. From a _json-context.yml/_json-context.yaml file in the same directory</span>
<span class="sd">    :param domain_cfg: domain configuration with uplift definition locations</span>
<span class="sd">    :param base: base URI for JSON-LD</span>
<span class="sd">    :param provenance_base_uri: base URI for provenance resources</span>
<span class="sd">    :param provenance_process_id: process identifier for provenance tracking</span>
<span class="sd">    :param fetch_url_whitelist: list of regular expressions to filter referenced JSON-LD context URLs before</span>
<span class="sd">        retrieving them. If None, it will not be used; if empty sequence or False, remote fetching operations will</span>
<span class="sd">        throw an exception</span>
<span class="sd">    :param transform_args: Additional arguments to pass as variables to the jq transform</span>
<span class="sd">    :return: List of output files created</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_fn</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">input_fn</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fn</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_fn</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input is not a file (</span><span class="si">{</span><span class="n">input_fn</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="n">contexts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">provenance_contexts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">context_fn</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">found_context</span> <span class="ow">in</span> <span class="p">(</span><span class="n">find_contexts</span><span class="p">(</span><span class="n">input_fn</span><span class="p">,</span> <span class="n">domain_config</span><span class="o">=</span><span class="n">domain_cfg</span><span class="p">)</span> <span class="ow">or</span> <span class="p">()):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">found_context</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
                <span class="n">contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">found_context</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Profile URI</span>
                <span class="n">artifact_urls</span> <span class="o">=</span> <span class="n">domain_cfg</span><span class="o">.</span><span class="n">profile_registry</span><span class="o">.</span><span class="n">get_artifacts</span><span class="p">(</span><span class="n">found_context</span><span class="p">,</span> <span class="n">profile</span><span class="o">.</span><span class="n">ROLE_SEMANTIC_UPLIFT</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">artifact_urls</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artifact_urls</span><span class="p">:</span>
                        <span class="n">contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
                        <span class="n">provenance_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context_fn</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context_fn</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">provenance_contexts</span> <span class="o">=</span> <span class="p">(</span><span class="n">context_fn</span><span class="p">,)</span>
        <span class="n">contexts</span> <span class="o">=</span> <span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">context_fn</span><span class="p">),)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">provenance_contexts</span> <span class="o">=</span> <span class="n">context_fn</span>
        <span class="n">contexts</span> <span class="o">=</span> <span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">context_fn</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">contexts</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingContextException</span><span class="p">(</span><span class="s1">&#39;No context file provided and one could not be discovered automatically&#39;</span><span class="p">)</span>

    <span class="c1"># Apply input filter of first context only (if any)</span>
    <span class="n">input_filters</span> <span class="o">=</span> <span class="n">contexts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input-filter&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">input_filters</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_filters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input-filter must be an object&#39;</span><span class="p">)</span>
        <span class="n">input_data</span> <span class="o">=</span> <span class="n">apply_input_filter</span><span class="p">(</span><span class="n">input_fn</span><span class="p">,</span> <span class="n">input_filters</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">input_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Input data:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">provenance_metadata</span><span class="p">:</span> <span class="n">ProvenanceMetadata</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">provenance_base_uri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">used</span> <span class="o">=</span> <span class="p">[</span><span class="n">FileProvenanceMetadata</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">input_fn</span><span class="p">,</span> <span class="n">mime_type</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span><span class="p">)]</span>
        <span class="n">used</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">FileProvenanceMetadata</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">mime_type</span><span class="o">=</span><span class="s1">&#39;application/yaml&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">provenance_contexts</span><span class="p">)</span>
        <span class="n">provenance_metadata</span> <span class="o">=</span> <span class="n">ProvenanceMetadata</span><span class="p">(</span>
            <span class="n">used</span><span class="o">=</span><span class="n">used</span><span class="p">,</span>
            <span class="n">batch_activity_id</span><span class="o">=</span><span class="n">provenance_process_id</span><span class="p">,</span>
            <span class="n">base_uri</span><span class="o">=</span><span class="n">provenance_base_uri</span><span class="p">,</span>
            <span class="n">root_directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
            <span class="n">start</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
            <span class="n">end_auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">transform_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">transform_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">transform_args</span><span class="p">[</span><span class="s1">&#39;_filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_fn</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
    <span class="n">transform_args</span><span class="p">[</span><span class="s1">&#39;_basename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_fn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">transform_args</span><span class="p">[</span><span class="s1">&#39;_dirname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_fn</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
    <span class="n">transform_args</span><span class="p">[</span><span class="s1">&#39;_relname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">input_fn</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">base</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_fn</span><span class="p">)</span>

    <span class="n">uplift_result</span> <span class="o">=</span> <span class="n">generate_graph</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span>
                                   <span class="n">context</span><span class="o">=</span><span class="n">contexts</span><span class="p">,</span>
                                   <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                                   <span class="n">fetch_url_whitelist</span><span class="o">=</span><span class="n">fetch_url_whitelist</span><span class="p">,</span>
                                   <span class="n">transform_args</span><span class="o">=</span><span class="n">transform_args</span><span class="p">)</span>

    <span class="n">uplift_result</span><span class="o">.</span><span class="n">input_file</span> <span class="o">=</span> <span class="n">input_fn</span>

    <span class="c1"># False = do not generate</span>
    <span class="c1"># None = auto filename</span>
    <span class="c1"># - = stdout</span>
    <span class="k">if</span> <span class="n">ttl_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ttl_fn</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">provenance_metadata</span><span class="p">:</span>
                <span class="n">provenance_metadata</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">FileProvenanceMetadata</span><span class="p">(</span><span class="n">mime_type</span><span class="o">=</span><span class="s1">&#39;text/turtle&#39;</span><span class="p">,</span> <span class="n">use_bnode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">generate_provenance</span><span class="p">(</span><span class="n">uplift_result</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">provenance_metadata</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">uplift_result</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ttl&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ttl_fn</span><span class="p">:</span>
                <span class="n">ttl_fn</span> <span class="o">=</span> <span class="n">input_fn</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.ttl&#39;</span><span class="p">)</span> \
                    <span class="k">if</span> <span class="n">input_fn</span><span class="o">.</span><span class="n">suffix</span> <span class="o">!=</span> <span class="s1">&#39;.ttl&#39;</span> \
                    <span class="k">else</span> <span class="n">input_fn</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">input_fn</span><span class="o">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;.ttl&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">provenance_metadata</span><span class="p">:</span>
                <span class="n">provenance_metadata</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">FileProvenanceMetadata</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">ttl_fn</span><span class="p">,</span>
                                                                    <span class="n">mime_type</span><span class="o">=</span><span class="s1">&#39;text/turtle&#39;</span><span class="p">,</span>
                                                                    <span class="n">use_bnode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">generate_provenance</span><span class="p">(</span><span class="n">uplift_result</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">provenance_metadata</span><span class="p">)</span>
            <span class="n">uplift_result</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="n">ttl_fn</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ttl&#39;</span><span class="p">)</span>
            <span class="n">uplift_result</span><span class="o">.</span><span class="n">output_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ttl_fn</span><span class="p">)</span>

    <span class="c1"># False = do not generate</span>
    <span class="c1"># None = auto filename</span>
    <span class="c1"># &quot;-&quot; = stdout</span>
    <span class="k">if</span> <span class="n">jsonld_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">jsonld_fn</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">uplift_result</span><span class="o">.</span><span class="n">uplifted_json</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">jsonld_fn</span><span class="p">:</span>
                <span class="n">jsonld_fn</span> <span class="o">=</span> <span class="n">input_fn</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.jsonld&#39;</span><span class="p">)</span> \
                    <span class="k">if</span> <span class="n">input_fn</span><span class="o">.</span><span class="n">suffix</span> <span class="o">!=</span> <span class="s1">&#39;.jsonld&#39;</span> \
                    <span class="k">else</span> <span class="n">input_fn</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">input_fn</span><span class="o">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;.jsonld&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonld_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">uplift_result</span><span class="o">.</span><span class="n">uplifted_json</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">uplift_result</span><span class="o">.</span><span class="n">output_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jsonld_fn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">uplift_result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="ogc.na.ingest_json.uplift_json" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">uplift_json</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">fetch_url_whitelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Transform a JSON document loaded in a dict, and embed JSON-LD context into it.</p>
<p>WARNING: This function modifies the input dict. If that is not desired, make a copy
before invoking.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>dict | list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the JSON document in dict format</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>YAML context definition</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fetch_url_whitelist</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>, bool]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of regular expressions to filter referenced JSON-LD context URLs before retrieving them. If None, it will not be used; if empty sequence or False, remote fetching operations will throw an exception.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>transform_args</code></td>
          <td>
                <code>dict | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional arguments to pass as variables to the jq transform</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the transformed and JSON-LD-enriched data</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>ogc/na/ingest_json.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">uplift_json</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                <span class="n">fetch_url_whitelist</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">transform_args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform a JSON document loaded in a dict, and embed JSON-LD context into it.</span>

<span class="sd">    WARNING: This function modifies the input dict. If that is not desired, make a copy</span>
<span class="sd">    before invoking.</span>

<span class="sd">    :param data: the JSON document in dict format</span>
<span class="sd">    :param context: YAML context definition</span>
<span class="sd">    :param fetch_url_whitelist: list of regular expressions to filter referenced JSON-LD context URLs before</span>
<span class="sd">        retrieving them. If None, it will not be used; if empty sequence or False, remote fetching operations will</span>
<span class="sd">        throw an exception.</span>
<span class="sd">    :param transform_args: Additional arguments to pass as variables to the jq transform</span>
<span class="sd">    :return: the transformed and JSON-LD-enriched data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">context_position</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;before&#39;</span><span class="p">)</span>

    <span class="n">validate_context</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">transform_args</span><span class="o">=</span><span class="n">transform_args</span><span class="p">)</span>

    <span class="c1"># Check whether @graph scoping is necessary for transformations and paths</span>
    <span class="n">scoped_graph</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scope&#39;</span><span class="p">,</span> <span class="s1">&#39;graph&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;graph&#39;</span> <span class="ow">and</span> <span class="s1">&#39;@graph&#39;</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="n">data_graph</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;@graph&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">scoped_graph</span> <span class="k">else</span> <span class="n">data</span>

    <span class="c1"># Check if pre-transform necessary</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
        <span class="c1"># Allow for transform lists to do sequential transformations</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="p">(</span><span class="n">transform</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transform</span><span class="p">):</span>
            <span class="n">tranformed_txt</span> <span class="o">=</span> <span class="n">jq</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">transform_args</span><span class="p">)</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">data_graph</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;After transform </span><span class="si">%d</span><span class="s1">:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tranformed_txt</span><span class="p">)</span>
            <span class="n">data_graph</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tranformed_txt</span><span class="p">)</span>

    <span class="c1"># Add types</span>
    <span class="n">types</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;types&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">type_list</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">json_path_parse</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">data_graph</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">type_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">type_list</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">existing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;@type&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">existing</span><span class="p">]</span> <span class="o">+</span> <span class="n">type_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">type_list</span><span class="p">)</span>
            <span class="n">item_types</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;@type&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item_types</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;@type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item_types</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;@type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Add contexts</span>
    <span class="n">context_list</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">global_context</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">context_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">loc</span> <span class="ow">or</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">]:</span>
            <span class="n">global_context</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">json_path_parse</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">data_graph</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;@context&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_injected_context</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">context_position</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_graph</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">data_context</span> <span class="o">=</span> <span class="n">data_graph</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;@context&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_context</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">global_context</span><span class="p">:</span>
                <span class="n">global_context</span> <span class="o">=</span> <span class="n">data_context</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">global_context</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">global_context</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data_context</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">global_context</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_context</span><span class="p">,</span> <span class="n">global_context</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">global_context</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_graph</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span> <span class="ow">or</span> <span class="n">scoped_graph</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;@context&#39;</span><span class="p">:</span> <span class="n">_get_injected_context</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">context_position</span><span class="p">),</span>
            <span class="s1">&#39;@graph&#39;</span><span class="p">:</span> <span class="n">data_graph</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">global_context</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;@context&#39;</span><span class="p">:</span> <span class="n">_get_injected_context</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">context_position</span><span class="p">),</span>
                <span class="o">**</span><span class="n">data_graph</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">data_graph</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
    
  </body>
</html>